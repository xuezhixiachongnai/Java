# 关闭线程池

在 Java 中，可以通过调用 `shutdown()`和`shutdownNow()`方法关闭线程池。

- 调用`shutdown()`方法时，线程池会停止接受新的任务，并尝试将所有未完成的任务完成
- 调用`shutdownNow()`方法时，线程池会停止接受新的任务，并尝试停止所有正在执行的任务。该方法会返回一个未完成任务列表，代表这些任务将被取消
- 调用`awaitTermination()`方法会阻塞当前线程，直到所有任务完成执行或者等待超时

> 当 Java 程序中还有非守护线程存活，JVM 就不会退出。通过`new Thread(...)`或者线程池创建的线程默认都是非守护线程。可以通过`thread.setDaemon(true)`将线程设置为守护线程。

如何优雅关停线程池：

```java
ExecutorService executor = Executors.newFixedThreadPool(5);

try {
    // 提交任务
    executor.submit(() -> {
        System.out.println("任务执行中");
    });
} finally {
    executor.shutdown(); // 不再接收新任务，等待已提交的任务执行完
    try {
        if (!executor.awaitTermination(60, TimeUnit.SECONDS)) {
            executor.shutdownNow(); // 超时后，尝试强制中断
        }
    } catch (InterruptedException e) {
        executor.shutdownNow();
        Thread.currentThread().interrupt();
    }
}

```

